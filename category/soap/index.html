<!DOCTYPE html>
<html>

  <head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>The Suhua Blog: soap</title>
	<meta name="description" content="Hi, This is Suhua Blog.">
	
	<link rel="icon" type="image/png" href="/blog/favicon.png" sizes="32x32">
	
	
	<link rel="stylesheet" href="/blog/main.css">
	
</head>

  <body>

    <div class="pagehead">
	<div class="container">
		<h1>
			<a href="/blog/" class="blog-title">The Suhua Blog: soap</a>
		</h1>
	</div>
</div>

    <div class="page-content">
      <div class="wrapper">
        <div class="container">
	<div class="blog-layout columns">
		<!-- three-fourths column -->
		<div class="three-fourths column">
			<div class="blog-content">
				<div class="posts">
					
		  			
		 			 
		  			
					
					<div class="blog-post">
						<h2 class="blog-post-title">
							<a href="/blog/soap/2015/09/16/soap-web-service.html">SOAP Web 服务介绍</a>
						</h2>
						<ul class="blog-post-meta">
							<li class="meta-item">
								<span class="octicon octicon-calendar"></span>
								2015-09-16
							</li>
							<!--
							<li class="meta-item">
								<img alt="@aisuhua" src="https://avatars0.githubusercontent.com/u/11390617?v=3&s=460"  class="author-avatar" height="18" width="18"> 
								<a href="###">aisuhua</a>
							</li>
							-->
							<li class="meta-item">
								<span class="octicon octicon-file-directory"></span>
								<a href="/blog/category/soap">soap</a>
							</li>
						</ul>
						<div class="blog-post-body markdown-body">
							<p>已经跨入 2015 年，当今最为常见的两种 Web 服务类型分别是： REST 和 SOAP 。不过，从趋势来看，越来越多人已经开始使用 REST 风格的 Web 服务。而 SOAP 大多也开始或已经转型 REST，应该说 REST 会慢慢成为主流。这篇文章不会对 REST 介绍太多，主要的重点还是介绍一下 SOAP 风格的 Web 服务。</p>

<h2 id="web-service-">Web Service 三要素</h2>

<p>实际上，现在说 “Web Service 三要素”应该是不算很准确了，不过这个概念一直这样沿用，而且本文我们为了更能清楚阐释 SOAP Web 服务，那么就这样定义。</p>

<p>Web Service 的三个要素分别是：</p>

<ol>
  <li>SOAP（Simple Object Access Protoco） 简单对象访问协议；</li>
  <li>WSDL（Web Services Description Language） 网络服务描述语言；</li>
  <li>UDDI（Universal Description Discovery and Integration）一个用来发布和搜索 WEB 服务的协议（非必须）；</li>
</ol>

<p>SOAP 用来描述传递信息的格式规范， WSDL 用来描述如何访问具体的接口（比如它会告诉你该服务有哪些接口可以使用，参数是什么等等）， UDDI 用来管理、分发和查询 Web Service。下面我们将逐一详细介绍这三个要素，并通过结合实例来进行阐释。</p>

<p>为了把这三个要素说得更清楚，我们将会使用一个免费的 SOAP Web 服务作为例子进行阐述。该服务只提供一个接口即：根据 QQ 号，获取 QQ 在线状态。<a href="http://www.webxml.com.cn/webservices/qqOnlineWebService.asmx">查看该服务</a></p>

<h2 id="soap">SOAP</h2>

<p>它是一个协议，可以简单的理解为：它定义了一个基于 XML 的可扩展消息信封格式。因为客户端与服务器进行交互，由于大家的平台和应用程序都不一样，所以大家约定都采用 SOAP 这个协议来规范交互时的需要传递的消息。</p>

<p>请求接口时，发送的消息例子：</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;soap:Body&gt;
        &lt;qqCheckOnline xmlns="http://WebXml.com.cn/"&gt;
            &lt;qqCode&gt;8698053&lt;/qqCode&gt;
        &lt;/qqCheckOnline&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</code></pre>

<p>接口响应时，返回的消息例子：</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;soap:Body&gt;
        &lt;qqCheckOnlineResponse xmlns="http://WebXml.com.cn/"&gt;
            &lt;qqCheckOnlineResult&gt;Y&lt;/qqCheckOnlineResult&gt;
        &lt;/qqCheckOnlineResponse&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</code></pre>

<p>注：以上例子是使用 SOAP 1.1 发送的消息，SOAP 1.2 发送的消息格式其实大同小异，具体自己<a href="http://www.webxml.com.cn/webservices/qqOnlineWebService.asmx?op=qqCheckOnline">查看接口文档</a>。</p>

<p>下面对它结构进行详细说明。</p>

<h3 id="xml-">XML 声明</h3>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</code></pre>

<p>该行是 XML 声明。它定义 XML 的版本 (1.0) 和所使用的编码（utf-8）。</p>

<h3 id="envelope-">Envelope 元素</h3>

<pre><code>&lt;soap:Envelope
    xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
	....
&lt;/soap:Envelope&gt;
</code></pre>

<p><code>Envelope</code> 元素是 SOAP 消息的固定根元素，SOAP 协议规定的，不能变，其中 <code>xmlns</code> 是 XML Namespace 的缩写，表示 XML 命名空间。<code>xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"</code> 是 <code>Envelope</code>的一个属性，它表示定义个以 <code>soap</code> 为前缀的命名空间 <code>http://schemas.xmlsoap.org/soap/envelope/</code>，即命名空间的名字是：<code>http://schemas.xmlsoap.org/soap/envelope/</code>，而它的前缀是 <code>soap</code>，这样子就把 <code>soap</code> 前缀与该命名空间进行了绑定。即任何用 <code>soap</code> 为前缀的元素都属于该命名空间的，包括根元素 <code>Envelope</code> 。举个例子：</p>

<pre><code>&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;soap:Body&gt;
        &lt;qqCheckOnline xmlns="http://WebXml.com.cn/"&gt;
            &lt;qqCode&gt;8698053&lt;/qqCode&gt;
        &lt;/qqCheckOnline&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</code></pre>

<p>其中，<code>Envelope</code> 和 <code>Body</code> 元素就是以 <code>soap</code> 为前缀的，那么 <code>Envelope</code> 和 <code>Body</code> 元素都是属于 <code>http://schemas.xmlsoap.org/soap/envelope/</code> 这个命名空间的。</p>

<p>同时，SOAP 协议中规定，SOAP 消息必须使用 SOAP Envelope 命名空间，所以 <code>http://schemas.xmlsoap.org/soap/envelope/</code> 这个命名空间是固定的不能变（注意：这里只针对 SOAP 1.1 版本，SOAP 1.2 会有所不同）。所有 SOAP 消息元素，比如：<code>Envelope</code>、<code>Header</code>、<code>Body</code>、<code>Fault</code> 也都必须属于该命名空间。</p>


							<a href="/blog/soap/2015/09/16/soap-web-service.html">继续阅读...</a>
				        </div>
					</div>
					
					<div class="blog-post">
						<h2 class="blog-post-title">
							<a href="/blog/soap/2015/09/12/soap-brief-analysis.html">SOAP 介绍</a>
						</h2>
						<ul class="blog-post-meta">
							<li class="meta-item">
								<span class="octicon octicon-calendar"></span>
								2015-09-12
							</li>
							<!--
							<li class="meta-item">
								<img alt="@aisuhua" src="https://avatars0.githubusercontent.com/u/11390617?v=3&s=460"  class="author-avatar" height="18" width="18"> 
								<a href="###">aisuhua</a>
							</li>
							-->
							<li class="meta-item">
								<span class="octicon octicon-file-directory"></span>
								<a href="/blog/category/soap">soap</a>
							</li>
						</ul>
						<div class="blog-post-body markdown-body">
							<h2 id="section">简介</h2>

<p>SOAP（Simple Object Access Protoco）简单对象访问协议是在分散或分布式的环境中交换信息的简单的协议，是一个基于 XML 的协议。此协议规范由 IBM、Microsoft、UserLand 和 DevelopMentor 在1998年共同提出，并得到 IBM，莲花（Lotus），康柏（Compaq）等公司的支持，于2000年提交给万维网联盟（World Wide Web Consortium；W3C）。现在，SOAP 协议规范由万维网联盟的 XML工作组维护。SOAP 1.2 版在2003年6月24日成为 W3C 的推荐版本。</p>

<p>SOAP 协议包括以下四个部分的内容：</p>

<ol>
  <li>SOAP 封装（envelop），封装定义了一个描述消息中的内容是什么，是谁发送的，谁应当接受并处理它以及如何处理它们的框架；</li>
  <li>SOAP 编码规则（encoding rules），它定义了不同应用程序间交换信息时，需要使用到的数据类型；</li>
  <li>SOAP RPC 表示（RPC representation），它定义了一个表示远程过程调用和应答的协定；</li>
  <li>SOAP 绑定（binding），它定义 SOAP 使用哪种底层协议交换信息的协定。使用 HTTP/TCP/UDP 协议都可以；</li>
</ol>

<h3 id="section-1">四个部分之间的关系</h3>

<p>SOAP 消息基本上是从发送端到接收端的单向传输，但它们常常结合起来执行类似于请求 / 应答的模式。所有的 SOAP 消息都使用 XML 编码。一条 SOAP 消息就是一个包含有一个必需的 SOAP 的封装包，一个可选的 SOAP 标头（Header）和一个必需的 SOAP 体块（Body）的 XML 文档。</p>

<p>把 SOAP 绑定到 HTTP 提供了同时利用 SOAP 的样式和分散的灵活性的特点以及 HTTP 的丰富的特征库的优点。在HTTP上传送 SOAP 并不是说 SOAP 会覆盖现有的 HTTP 语义，而是 HTTP 上的 SOAP 语义会自然的映射到 HTTP 语义。在使用 HTTP 作为协议绑定的场合中， RPC 请求映射到 HTTP 请求上，而 RPC 应答映射到 HTTP 应答。然而，在 RPC 上使用 SOAP 并不仅限于 HTTP 协议绑定。SOAP也可以绑定到TCP和UDP协议上。</p>

<p>虽然这四个部分都作为 SOAP 的一部分，作为一个整体定义的，但他们在功能上是相交的、彼此独立的。特别的，信封（envelop）和编码规则（encoding rules）是被定义在不同的 XML 命名空间中，这样使得定义更加简单。</p>

<h2 id="section-2">语法规则</h2>

<ol>
  <li>SOAP 消息必须用 XML 来编码；</li>
  <li>SOAP 消息必须使用 SOAP Envelope 命名空间；</li>
  <li>SOAP 消息必须使用 SOAP Encoding 命名空间；</li>
  <li>SOAP 消息不能包含 DTD 引用；</li>
  <li>SOAP 消息不能包含 XML 处理指令；</li>
</ol>

<h2 id="soap-">SOAP 消息格式</h2>

<p>SOAP 消息的格式比较简单，如下图：</p>

<p><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/SOAP.svg/225px-SOAP.svg.png"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/SOAP.svg/225px-SOAP.svg.png" alt="SOAP 消息格式" /></a></p>

<p>下面是一条 SOAP 消息的基本格式：</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;soap:Envelope
    xmlns:soap="http://www.w3.org/2003/05/soap-envelope"
    soap:encodingStyle="http://www.w3.org/2003/05/soap-encoding"&gt;
    &lt;soap:Header&gt;
        &lt;!-- 消息头，可选 --&gt;
    &lt;/soap:Header&gt;
    &lt;soap:Body&gt;
        &lt;!-- 消息内容，必需 --&gt;

        &lt;soap:Fault&gt;
            &lt;!-- 错误信息，可选 --&gt;
        &lt;/soap:Fault&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</code></pre>

<p>一条 SOAP 消息就是一个普通的 XML 文档，包含如下元素：</p>

<ol>
  <li>必需的 Envelope 元素，据此可把该 XML 文档标识为一条 SOAP 消息；</li>
  <li>可选的 Header 元素，包含头部信息，一般用于身份验证；</li>
  <li>必需的 Body 元素，包含所有的调用和响应信息；</li>
  <li>可选的 Fault 元素，提供有关在处理此消息时，所发生的错误的描述信息；</li>
</ol>


							<a href="/blog/soap/2015/09/12/soap-brief-analysis.html">继续阅读...</a>
				        </div>
					</div>
					
					
		 			 		 
				</div>
			</div>
		</div> 
		
		<!-- one-fourth column -->
		<div class="one-fourth column">
	<div class="blog-aside">
		<nav class="menu">
		  
		  	
			 	<a class="menu-item" href="/blog/category/php"><span class="counter">1</span>php</a>
			
		  
		  	
				<a class="menu-item selected" href="/blog/category/soap"><span class="counter">2</span>soap</a>
			
		  		  
		</nav>
		<a class="rss" href="/blog/feed.xml">
		    <span class="octicon octicon-rss"></span>
		    Subscribe
		</a>
	</div>
</div> 
		  
	</div> <!-- columns-->
</div> <!-- container-->

      </div>
    </div>

    <div class="footer">
	<div class="container">
	  <div class="site-footer">
	    <ul class="site-footer-links">
	      <li><span class="tooltipped tooltipped-n" aria-label="一个记录着我成长历程的博客。">The Suhua Blog</span></li>
	        <li><a href="/blog/">博客</a></li>
	        <li><a href="javascript:void(0);" class="tooltipped tooltipped-ne" aria-label="别急，我还在整理呢~">智库</a></li>
	        <li><a href="https://github.com/aisuhua">Github</a></li>
			<li><a href="http://www.cnblogs.com/isuhua">博客园</a></li>
			<li><a href="http://segmentfault.com/u/aisuhua">Segmentfault</a></li>
			<li><a href="http://www.zhihu.com/people/aisuhua">知乎</a></li>
	        <li><a href="/blog/about/">关于</a></li>
	    </ul>
	  </div>
	</div>
</div>


<script src="/blog/js/anchor.min.js"></script>
<script src="/blog/js/highlight.min.js"></script>


<script>
anchors.add('.markdown-body h2, .markdown-body h3, .markdown-body h4');
hljs.initHighlightingOnLoad();
</script>


  </body>

</html>
